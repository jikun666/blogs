Redis 是一个内存数据库，如果不把储存在内存中的数据库状态持久化到磁盘，那么一旦服务器进程退出，整个数据库状态也会丢失。

RDB 持久化是 redis 将数据库保存到磁盘的解决方案之一（另一种是 AOF）。


RDB 生成的 RDB 文件是一个经过压缩的二进制个文件，通过该文件可以还原生成 RDB 文件时的数据库状态。该文件保存在磁盘，不会因进程退出或关机而丢失。



## RDB 文件的创建和载入

通过 SAVE 或 BGSAVE 生成 RDB 文件。

### 创建

**SAVE** 命令会阻塞 Redis 服务器进程直到 RDB 文件创建为止，在阻塞期间，服务器不能处理任何命令请求。


**BGSAVE** 命令则会派生出一个子进程，然后由子进程负责创建 RDB 文件，父进程继续处理命令请求。

---

注意，BGSAVE 执行期间，虽然服务器可以继续处理命令，但是对于客户端新请求的 SAVE 和 BGSAVE 命令会被拒绝执行，对于 BGREWRITEAOF 命令则会延迟到 BGSAVE 执行完毕后执行。

不能同时执行 BGSAVE 和 BGREWRITEAOF 只是一个性能方面的考虑：并发出两个子进程，并且两个子进程都同时进行大量的磁盘写入操作，对服务器压力较大。

---

### 载入

服务器在载入 RDB 文件期间，会一直处于阻塞状态，直到载入工作完成为止。

注意，如果服务器开启来 AOF 持久化，那么服务器会优先载入 AOF 文件而放弃载入 RDB 文件。



## RDB 触发

### 手动触发

用户可手动触发 RDB 过程，只需发送 SAVE 或 BGSAVE 命令即可。

### 自动触发

由于 BGSAVE 不阻塞主进程，所以 redis 允许用户配置自动触发。

用户设置服务器配置的 save 选项，让服务器每隔一段时间自动执行一次 BGSAVE 命令。

可在 save 选项设置多个保存条件，只要其中任意一个条件被满足，服务器就会执行 BGSAVE 命令。

比如，save 选项配置如下：

```
save 900 1
save 300 10
save 60 10000
```

那么只要满足以下三个条件中的任意一个，BGSAVE 命令就会执行：

- 900 秒内，对数据库进行过至少 1 次修改；
- 300 秒内，对数据库进行过至少 10 次修改；
- 60 秒内，对数据库进行过至少 10000 次修改；


Redis 的服务器周期性操作函数 severCron 默认每隔 100ms 就会执行一次，该函数用于对正在运行的服务器进行维护，它的其中一项工作就是检查 save 选项所设置的保存条件是否已经满足，如果满足，就会执行 BGSAVE 命令。